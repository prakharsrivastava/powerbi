import org.apache.spark.sql.{SparkSession, DataFrame}
import org.apache.spark.sql.functions._
import org.apache.spark.sql.types._

// Sample data
val data = Seq(
  Seq(("color", "black"), ("gift", "no")),
  Seq(("color", "blue"), ("gift", "yes"))
)

// Create SparkSession
val spark = SparkSession.builder()
  .appName("Convert Array of Structs to JSON Array")
  .master("local[*]")
  .getOrCreate()

import spark.implicits._

// Create DataFrame with schema
val schema = StructType(Seq(
  StructField("demo", ArrayType(StructType(Seq(
    StructField("label", StringType, nullable = false),
    StructField("value", StringType, nullable = false)
  ))), nullable = false)
))

// Create DataFrame from sample data
val df = spark.createDataFrame(data.map(Row(_)), schema)

// Display the original DataFrame
println("Original DataFrame:")
df.show(false)

// Convert demo array column to JSON array format
val jsonDF = df.withColumn("demo_json", to_json($"demo"))

// Display the transformed DataFrame
println("Transformed DataFrame:")
jsonDF.show(false)

// Stop SparkSession
spark.stop()
